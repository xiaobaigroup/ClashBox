//ä¸»é¡µ æ …æ ¼å¸ƒå±€ã€åª’ä½“æŸ¥è¯¢
import { BreakpointState } from '../common/breakpoint/breakpointsystem'
import { curves, PromptAction } from '@kit.ArkUI'
import SwitchMode from '../components/Home/SwitchMode'
import CellularData from '../components/Home/CellularData'
import PublicNetwork from '../components/Home/PublicNetwork'
import Speed from '../components/Home/Speed'
import { getGreeting } from '../common/utils/GreetingUtil'
import { hilog } from '@kit.PerformanceAnalysisKit'
import { Timer } from '../common/utils/HHmmssTimer'
import {
  BIND_SHEET_CONTAINER_HEIGHT,
  TAB_CONTENT_TITLE_HEIGHT,
  showHomeCard,
  showHomeCardPC,
} from '../common/entity/Constants'
import Settings from '../components/Settings/Settings'
import CurrentNode from '../components/Home/CurrentNode'
import FavoriteProxy from '../components/Home/FavoriteProxy'
import FavoriteConfiguration from '../components/Home/FavoriteConfiguration'
import { CardEdit } from '../components/Home/CardEdit'
import ProxyINFO from '../components/Home/ProxyINFO'
import CurrentConfiguration from '../components/Home/CurrentConfiguration'
import ClashViewModel from '../entryability/ClashViewModel'
import Shortcuts from '../components/Home/Shortcuts'
import { AppConfig, UIConfig } from '../entryability/AppState'
import { ConfigData, HomeCardInfo } from '../common/entity/PageArgumentEntity'
import { customVibrator } from '../common/utils/VibratorUtil'
import { customAnimationUtil } from '../common/utils/Animation'
import { Profile, ProxyGroup, ProxyMode } from 'proxy_core'
import { ProxyGroupItemDataSource, ProxyItemDataSource } from '../common/datasources/ProxyData'
import { EventHub, EventKey } from '../common/EventHub'
import { PopTips, PopupBuilder } from '../components/Start/Popup'
import { getResourceString } from '../common/utils/ResourceStringUtil'
import { TopBar } from '../components/Common/TopBar'
import {
  HomeCardDeleteButtonSize,
  HomeCardGutter,
  HomeCardSpan346lg, HomeCardSpan346md, HomeCardSpan36sm,
  HomeGridRowPadding } from '../common/breakpoint/BreakPoint'


@Entry
@Component
struct Home {
  // ä¸»é¢˜è‰²
  @Consume('icon_emphasize') icon_emphasize: ResourceColor
  // æ˜¯å¦å¼€å¯ `Index` é¡µé¢çš„å‰æ™¯æ¨¡ç³Š
  @Consume('isEnableIndexForegroundBlur') isEnableIndexForegroundBlur: boolean
  // ç¼–è¾‘æŒ‰é’®ç‚¹å‡»åæ˜¾ç¤ºç¼–è¾‘çŠ¶æ€åˆ¤å®š
  @Consume @Watch('ShowHomeEditChange') isShowHomeEdit: boolean
  // å‰å°åˆ¤æ–­å˜é‡
  @Consume @Watch('onForeward') isForeward: boolean
  @Consume isSmallSquareScreen: boolean
  // åˆ é™¤æŒ‰é’®æ˜¯å¦å‡ºç°åˆ¤å®š
  @Consume isShowDeleteButton: boolean
  // å¹³æ¿æ¨ªå±
  @Consume istabletLandscape: boolean
  // è®¾ç½®æ¨¡æ€é¡µæ§åˆ¶å˜é‡
  @Consume @Watch('ShowHomeEditChange') isShowSettings: boolean
  // æ˜¯å¦ä¸ºPXå¤–å±
  @Consume isPXSecScreen: boolean
  // ä»£ç†å¯åŠ¨æŒ‰é’®çŠ¶æ€
  @Consume proxyEnabled: boolean
  @Consume isRolling: boolean

  /* å½“å‰è®¾å¤‡`height`æ˜¯å¦ç¬¦åˆ(320vp< height <= 500vp) */
  @StorageLink ('isLandscapePhone') @Watch('isLandscapePhoneScrollTo') isLandscapePhone: boolean = false
  // æŠ˜å å±å±•å¼€çŠ¶æ€åˆ¤å®š
  @StorageLink ('isFoldStatus') isFoldStatus: boolean = false
  // çª—å£æ¨¡å¼åŒºåˆ†ï¼Œtrueä¸ºçª—å£å¼ï¼Œfalseä¸ºæ™®é€šå¼
  @StorageProp('WindowMode') windowMode: boolean = false
  // 2in1åˆ¤å®š
  @StorageLink ('2in1') is2in1: boolean = false
  // ä¸»é¡µåŠæ¨¡æ€é¡µ
  @State showHomeSheet: boolean = false

  // æ‰€æœ‰å­ç»„ä»¶åœ¨å®¹å™¨å†…çš„å¯¹é½æ–¹å¼
  @Consume ('stackAlignContentAlignment') stackAlignContentAlignment: Alignment
  // è®¾ç½®é¡µé¢æ ˆ
  @Consume('NavSettingsPathStack') SettingsPageInfos: NavPathStack

  private promptAction: PromptAction = this.getUIContext()?.getPromptAction()
  @StorageLink('appConfig') appConfig: AppConfig = new AppConfig()
  @StorageLink('uiConfig') uiConfig: UIConfig = new UIConfig()
  // æ»šåŠ¨æ§åˆ¶
  private scrollerForScroll: Scroller = new Scroller()

  // ä»£ç†é¡µåˆ†ç»„æ•°æ®ï¼ˆæ‡’åŠ è½½ï¼‰
  @Consume proxyGroups: ProxyGroupItemDataSource
  // èŠ‚ç‚¹æ•°æ®
  @Consume proxyLazyItems: ProxyItemDataSource
  // é…ç½®é¡µæ•°æ®è¡¨
  @Consume configList: Array<ConfigData>
  // å½“å‰ä¸»é¡µå¸ƒå±€
  @Consume theCurrentHomeCard: boolean[]
  // èŠ‚ç‚¹æ•°æ®ç»„
  @Consume theProxyGroups: ProxyGroup[]
  // ä¸Šä¸€æ¬¡ä¸»é¡µå¸ƒå±€
  @Consume theLastHomeCard: boolean[]

  // é«˜åº¦æ–­ç‚¹
  @StorageLink ('currentHeightBreakpoint') heightBp: HeightBreakpoint = 0
  // å®½åº¦æ–­ç‚¹
  @StorageLink ('currentWidthBreakpoint') widthBp: WidthBreakpoint = 1
  // æŒ‰é’®å®½åº¦
  // @State  proxyStartButtonWidth: Length = $r('app.integer.vp_proxy_not_start_button_width')
  // æŒ‰é’®é«˜åº¦
  @State  proxyStartButtonHeight: Length = $r('app.integer.vp_proxy_not_start_button_height')
  // é¡µé¢åç§° ä¸»é¡µ
  private componentName: string = 'HomePage'
  // ä»£ç†å¯åŠ¨æŒç»­çš„æ—¶é—´
  @Consume proxyStartingDuration: string

  @Consume curOffsetRemain: number
  // æ¢å¤æ—¶åˆ»
  @Consume theRestoreTime: number
  // æš‚åœæ—¶åˆ»
  @Consume thePauseTime: number
  @Consume rotateAngle : number
  // pageå†…é¡¶éƒ¨æ ‡é¢˜åç§»é‡
  @Consume curYOffset: number
  // pxå¤–å±éšè—topå’Œtabåç§»
  @Consume heightTop: number

  @Consume ("currentProfile") currentProfile: Profile | null
  // å®šæ—¶å™¨Controller
  @Consume proxyStartedTimer: Timer


  // æŒ‰é’®å‰SymbolåŠ¨æ•ˆ
  // ReplaceSymbolEffect: SymbolEffect = EffectScope.WHOLE

  build() {
    Stack() {
      if (!this.isLandscapePhone) {
        Row() {
          if (!this.isShowHomeEdit) {
            // ç¼–è¾‘å¸ƒå±€æŒ‰é’®åˆ¤å®šï¼šéç¼–è¾‘çŠ¶æ€
            // é¡¶æ 
            TopBar({
              title: this.uiConfig.isGreeting ? getResourceString(getGreeting(), this) : 'ClashBox',
              icons: [$r('sys.symbol.square_and_pencil'), $r('sys.symbol.gearshape')],
              iconSize: this.windowMode ? 16 : 24,
              // ç¼–è¾‘æŒ‰é’®
              onFClick: () => {
                this.isShowHomeEdit = true
                // ç¼–è¾‘å¸ƒå±€å‰å‚¨å­˜ä¹‹å‰çš„å¸ƒå±€å˜é‡
                hilog.info(0xFF00, "HometestTag", "ä¸Šä¸€æ¬¡å¸ƒå±€1ï¼š %{public}s", JSON.stringify(this.theLastHomeCard))
                this.theLastHomeCard = JSON.parse(this.uiConfig.isShowHomeCard)
                hilog.info(0xFF00, "HometestTag", "ä¸Šä¸€æ¬¡å¸ƒå±€2ï¼š %{public}s", JSON.stringify(this.theLastHomeCard))
                if (this.uiConfig.isAnimation) {
                  animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                    this.isShowDeleteButton = true
                  })
                } else {
                  this.isShowDeleteButton = true
                }
              },
              // è®¾ç½®æŒ‰é’®
              onSClick: () => {
                this.isShowSettings = true
                this.showHomeSheet = true
                this.isEnableIndexForegroundBlur = true
              }
            })
          } else {
            // ç¼–è¾‘å¸ƒå±€æŒ‰é’®åˆ¤å®šï¼šæ˜¯ç¼–è¾‘çŠ¶æ€
            TopBar({
              title: `${getResourceString($r('app.string.home_edit'), this)}`,
              titleFontSize: this.windowMode ? 20 : 24,
              icons: [$r('sys.symbol.plus'), $r('sys.symbol.save'), $r('sys.symbol.xmark')],
              // æ·»åŠ æŒ‰é’®
              onFClick: () => {
                this.isShowSettings = false
                this.showHomeSheet = true
                this.isEnableIndexForegroundBlur = true
              },
              onSClick: () => {
                this.saveHomeLayout()
              },
              onTClick: () => {
                if (this.SaveDialogController != null) {
                  this.SaveDialogController.open()
                  this.isEnableIndexForegroundBlur = true
                }
              }
            })
          }

        }
        .zIndex(1)
        .position({x: 0,y:this.isRolling && this.isSmallSquareScreen?this.heightTop:0})
        .width('100%')
        .geometryTransition("Button")
      }

      Stack({ alignContent: this.stackAlignContentAlignment }) {
        // ä¸»é¡µå¡ç‰‡å±‚
        Column() {
          Blank()
            .height(this.isLandscapePhone || (this.isRolling && this.isSmallSquareScreen) ? this.heightTop : this.istabletLandscape ? 72 : TAB_CONTENT_TITLE_HEIGHT)
          Scroll() {
            Column() {
              GridRow({
                gutter: HomeCardGutter(this.widthBp, this.heightBp),
              })
              {
                ForEach(this.homeCardList(), (item: HomeCardInfo, index: number) => {
                  HomeCard({
                    item: item,
                    index: index
                  })
                }, (item: HomeCardInfo, index: number) => `${item.order}${index}`)
              }
              Blank().height(100)
            }
          }
          .layoutWeight(1)
          .align(Alignment.Top)
          .scrollBar(BarState.Off)
          .padding(HomeGridRowPadding(this.widthBp, this.heightBp))
          // .enableScrollInteraction(!this.windowMode)
          .margin({ top: this.isLandscapePhone ? 7 : 0 })
          .edgeEffect(this.uiConfig.isAnimation ? EdgeEffect.Spring : null)
          .onScrollFrameBegin((offset: number) => {
            if (!this.windowMode) {
              this.curOffsetRemain  += offset
              if (offset > 0) {
                this.isRolling = true
              } else if(offset < 0) {
                this.isRolling = false
                this.curOffsetRemain = 0
              }
              console.info("offsetRemain:" + offset + '/' +this.curOffsetRemain);
              return { offsetRemain: offset }
            } else {
              return { offsetRemain: 0 }
            }
          })
          .onDidScroll((xOffset: number, yOffset: number, scrollState: ScrollState): void => {
            if (!this.windowMode) {
              // ç´¯è®¡è®¡ç®—å½“å‰çˆ¶ç»„ä»¶æ»šåŠ¨åœ¨Yè½´æ–¹å‘çš„åç§»é‡
              if (this.uiConfig.isAnimation){
                this.curYOffset += yOffset
              }
              console.info("yOffset:" + yOffset)
            }
          })
        }
        // ä»£ç†å¯åŠ¨æŒ‰é’®å±‚
        if (!this.isShowHomeEdit) {
          Column() {
            Row() {
              Stack({ alignContent: Alignment.Center }) {
                SymbolGlyph(this.proxyEnabled ? $r('sys.symbol.pause') : $r('sys.symbol.play_fill'))
                  .fontSize(24)
                  .fontColor([Color.White])
                  .align(Alignment.Center)
                  .effectStrategy(customAnimationUtil.isIconEffect(this.uiConfig))
              }
              .width(this.proxyStartButtonHeight)
              .height(this.proxyStartButtonHeight)
              // è®¡æ—¶å™¨æ–‡æœ¬
              Text(this.proxyStartingDuration)
                .fontSize(20)// ä½¿ç”¨é€æ˜åº¦æ§åˆ¶æ˜¯å¦æ˜¾ç¤ºè®¡æ—¶å™¨ï¼Œæ˜¯å› ä¸ºç”¨ `visibility` æ¥æ§åˆ¶çš„è¯ï¼Œä¸æ˜¾ç¤ºçš„æ—¶é—´é•¿äº†ä¹‹åï¼Œå†æ¬¡æ˜¾ç¤ºæ—¶å€™ä¼šå»¶è¿Ÿä¸€ç§’ï¼Œä½“éªŒä¸å¥½
                .fontColor(this.proxyEnabled ? Color.White : Color.Transparent)
                .fontWeight(FontWeight.Bold)
            }.width('100%')
          }
          .borderRadius(100)
          .transition(customAnimationUtil.isSlideSwitch(this.uiConfig))
          .backgroundColor(this.icon_emphasize)
          .shadow({
            radius: 10,
            color: this.icon_emphasize,
            offsetY: 4,
            type: ShadowType.BLUR
          })
          .margin({
            bottom: this.isLandscapePhone || this.istabletLandscape || !this.uiConfig.isBlurr || (this.isRolling && this.isSmallSquareScreen) ? $r('app.integer.vp_proxy_start_button_left_right_margin') : $r('app.integer.vp_proxy_start_button_bottom_margin'),
            right:$r('app.integer.vp_proxy_start_button_left_right_margin'),
            left:$r('app.integer.vp_proxy_start_button_left_right_margin')
          })
          .width(this.proxyEnabled ? $r('app.integer.vp_proxy_started_button_width') : $r('app.integer.vp_proxy_not_start_button_width'))
          .height(this.proxyStartButtonHeight)
          .clip(true)
          .onClick(async (event: ClickEvent) => {
            if(this.configList.length === 0 || this.theProxyGroups.length === 0) {
              if (this.uiConfig.isVibrate) {
                customVibrator.vibratorTriggerOfHapticClockTimer()
              }
              // é…ç½®é¡µæ²¡æœ‰æ•°æ®ï¼Œæˆ–è€…ä»£ç†èŠ‚ç‚¹æœªåŠ è½½
              this.promptAction.showToast({ message: `${getContext().resourceManager.getStringSync($r('app.string.start_prompt'))}` })
              // vpnå°é’¥åŒ™å¯èƒ½å¡æ­»ï¼Œå…³é—­vpnå°é’¥åŒ™
              await ClashViewModel.StopVpn()
            } else {
              hilog.info(0xA002, this.componentName, `ä¸»é¡µæŒ‰é’®ç‚¹å‡»äº‹ä»¶ ä»£ç†å¯åŠ¨æŒ‰é’®çŠ¶æ€ï¼š${this.proxyEnabled}`)
              this.proxyEnabled = !this.proxyEnabled
              if (this.proxyEnabled) {
                await ClashViewModel.StartVpn()
              } else {
                await ClashViewModel.StopVpn()
              }
              if (this.uiConfig.isVibrate) {
                customVibrator.vibratorTriggerOfHapticClockTimer()
              }
            }
          })
          .animation(this.uiConfig.isAnimation?{ duration: this.uiConfig.animationSpeed,curve:curves.springMotion() }:null)
          .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
          .bindPopup(!!this.uiConfig.ShowStartPop, {
            builder: PopupBuilder(this, PopTips[0], () => {
              this.uiConfig.ShowStartPop = false
            }),
            onWillDismiss: false,
            autoCancel: false
          })
        }
      }
      .backgroundColor($r('app.color.background'))
      .height('100%' )
      .width("100%")
      .bindSheet($$this.showHomeSheet, this.HomeSheet(), {
        detents: [BIND_SHEET_CONTAINER_HEIGHT, SheetSize.LARGE],
        preferType: SheetType.CENTER,
        scrollSizeMode: ScrollSizeMode.CONTINUOUS,
        backgroundColor: $r('app.color.background'),
        dragBar: false,
        title: this.isShowSettings ? undefined : { title: $r('app.string.add_home_card') },
        keyboardAvoidMode: SheetKeyboardAvoidMode.RESIZE_ONLY,
        onWillDismiss: () => {
          this.isShowSettings = false
          this.showHomeSheet = false
          this.isEnableIndexForegroundBlur = false
          this.SettingsPageInfos.clear()
        }
      })
    }.width('100%').height('100%')
  }


  @Builder
  HomeSheet() {
    if (this.isShowSettings) {
      // è®¾ç½®æ¨¡æ€ç•Œé¢
      Column() {
        Settings()
      }
      .width('100%')
      .height('100%')
    } else {
      // å¡ç‰‡ç¼–è¾‘åŠæ¨¡æ€
      CardEdit()
    }
  }

  /**æ˜¯å¦ä¿å­˜å¸ƒå±€å¼¹çª—*/
  SaveDialogController: CustomDialogController | null = new CustomDialogController({
    builder: SaveCustomDialog({
      cancel: () => {
        this.onCancel()
        animateTo({ duration: 0,iterations:0 }, () => {
          this.rotateAngle = 0
        })
      },
      confirm: () => {
        this.onAccept()
        animateTo({ duration: 0,iterations:0 }, () => {
          this.rotateAngle = 0
        })
      }
    }),
    cancel: this.existApp,
    autoCancel: true,
    alignment: DialogAlignment.Center,
    customStyle: false,
    cornerRadius: 32,
  })

  aboutToAppear(): void {
    // åˆå§‹åŒ–ä¸»é¡µå¡ç‰‡å¸ƒå±€
    if (this.uiConfig.isShowHomeCard)
      this.theCurrentHomeCard = JSON.parse(this.uiConfig.isShowHomeCard)
    hilog.info(0xFF00, "HometestTag", "å¸ƒå±€åˆå§‹åŒ–ä¸ºï¼š %{public}s", JSON.stringify(this.theCurrentHomeCard))
    EventHub.on(EventKey.SwitchModeCard, async (mode: ProxyMode) => {
      // æ¸…ç©ºæ•°æ®
      this.proxyGroups.empty()
      this.proxyLazyItems.empty()
      if (this.currentProfile) {
        await ClashViewModel.loadConfig(true)
        // å†™å…¥æ•°æ®
        this.theProxyGroups = await ClashViewModel.getProxyGroups(mode)
        this.proxyGroups.pushData(this.theProxyGroups)
      }
    })

    // åªæœ‰å½“PCé¦–æ¬¡å¯åŠ¨æ—¶é‡ç½®ä¸»é¡µå¸ƒå±€
    if (this.is2in1 && this.uiConfig.isShowHomeCard === JSON.stringify(showHomeCard)) {
      this.theCurrentHomeCard = showHomeCardPC
      // æ›´æ–°PCå¸ƒå±€æŒä¹…åŒ–, é¿å…äºŒæ¬¡å¯åŠ¨é‡å¤è°ƒç”¨è¦†ç›–
      this.uiConfig.isShowHomeCard = JSON.stringify(showHomeCardPC)
    }

  }

  aboutToDisappear() {
    // å°†dialogControllerç½®ç©º
    this.SaveDialogController = null
    EventHub.off(EventKey.SwitchModeCard)
  }

  homeCardList(): HomeCardInfo[] {
    return [
      { // ç½‘ç»œé€Ÿåº¦å°å¡ç‰‡
        aspectRatio: 2.07,
        order: 1
      },
      { // åˆ†æµæ¨¡å¼å°å¡ç‰‡
        aspectRatio: 1,
        order: 2
      },
      { // æµé‡ç»Ÿè®¡å°å¡ç‰‡
        aspectRatio: 1,
        order: 3
      },
      { // å½“å‰èŠ‚ç‚¹å°å¡ç‰‡
        aspectRatio: 1,
        order: 4
      },
      { // IPåœ°å€å°å¡ç‰‡
        aspectRatio: 1,
        order: 5
      },
      { // æ”¶è—èŠ‚ç‚¹å°å¡ç‰‡
        aspectRatio: 1,
        order: 6
      },
      { // æ”¶è—é…ç½®å°å¡ç‰‡
        aspectRatio: 1,
        order: 7
      },
      { // èŠ‚ç‚¹ä¿¡æ¯å°å¡ç‰‡
        order: 8/*HomeCardProxyInfoOrder(this.widthBp, this.heightBp)*/,
        aspectRatio: 2.07,
      },
      { // å½“å‰é…ç½®å°å¡ç‰‡
        aspectRatio: 1,
        order: 9
      },
      { // å¿«æ·æ–¹å¼å°å¡ç‰‡
        aspectRatio: 1,
        order: 10
      }
    ]
  }

  // åœ¨è‡ªå®šä¹‰ç»„ä»¶å³å°†ææ„é”€æ¯æ—¶å°†dialogControllerç½®ç©º
  onCancel() {
    this.restoreLayout()
    this.isEnableIndexForegroundBlur = false
    hilog.info(0xA000, this.componentName, '#onCancel: Callback when the first button is clicked')
  }

  onAccept() {
    this.saveHomeLayout()
    this.isEnableIndexForegroundBlur = false
    hilog.info(0xA000, this.componentName, '#onAccept: Callback when the second button is clicked')
  }

  existApp() {
    this.isEnableIndexForegroundBlur = false
    hilog.info(0xA000, this.componentName, '#existApp: Click the callback in the blank area')
  }

  /**æ¨ªå±HOMEé¡µæ»šåŠ¨åˆ°ä¸­é—´*/
  isLandscapePhoneScrollTo() {
    if (this.isLandscapePhone) {
      this.scrollerForScroll.scrollTo({xOffset: 0,yOffset: '50%',animation: true})
    }
  }

  // å¡ç‰‡æ‘‡æ‘†åŠ¨ç”»
  startAnim() {
    this.rotateAngle = 0
    animateTo({
      duration: this.uiConfig.animationSpeed,
      curve: Curve.Linear,
      iterations:-1,
      playMode:PlayMode.Alternate
    }, () => {
      this.rotateAngle = 1
    })
  }

  stopAnim() {
    animateTo({
      delay: 0,
      duration: 0,
      iterations: 0,
      curve: Curve.Linear,
    }, () => {
      this.rotateAngle = 0
    })
  }

  /**ä¿å­˜ä¸»é¡µå¡ç‰‡å¸ƒå±€*/
  saveHomeLayout() {
    // ä¿å­˜å¸ƒå±€
    this.uiConfig.isShowHomeCard = JSON.stringify(this.theCurrentHomeCard)
    hilog.info(0xFF00, "HometestTag", "ä¿å­˜çš„å¸ƒå±€ï¼š %{public}s", this.uiConfig.isShowHomeCard)
    this.promptAction.showToast({ message: `${getContext().resourceManager.getStringSync($r('app.string.layout_saved'))}ğŸ’¾` })
    this.isShowHomeEdit = false
    if (this.uiConfig.isAnimation) {
      animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
        this.isShowDeleteButton = false
      })
    } else { this.isShowDeleteButton = false }
  }

  /**è¿˜åŸä¸»é¡µå¡ç‰‡å¸ƒå±€*/
  restoreLayout() {
    // è¿˜åŸå¸ƒå±€
    this.theCurrentHomeCard = this.theLastHomeCard
    this.uiConfig.isShowHomeCard = JSON.stringify(this.theLastHomeCard)
    hilog.info(0xFF00, "HometestTag", "å¸ƒå±€è¿˜åŸä¸ºï¼š %{public}s", JSON.stringify(this.theCurrentHomeCard))
    this.promptAction.showToast({ message: `${getContext().resourceManager.getStringSync($r('app.string.layout_restored'))}ğŸ«¡` })
    this.isShowHomeEdit = false
    animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
      this.isShowDeleteButton = false
    })
  }

  /**å¡ç‰‡ç¼–è¾‘é¡µé¢æ˜¾ç¤ºç›‘å¬*/
  ShowHomeEditChange() {
    hilog.info(0xFF00, "HometestTag", "è¿›å…¥å¡ç‰‡ç¼–è¾‘é¡µé¢æ˜¾ç¤ºç›‘å¬  %{public}s")
    // å±•ç¤ºç¼–è¾‘é¡µæ—¶æ‰è§¦å‘
    if (!this.isShowSettings) {
      // å½“ç¼–è¾‘é¡µé¢ç”± true -> false æ—¶è§¦å‘æŠ–åŠ¨åŠ¨ç”»åˆ·æ–°
      if(this.isShowHomeEdit && !this.isShowSettings) {
        hilog.info(0xFF00, "HometestTag", "è¿›å…¥å¡ç‰‡ç¼–è¾‘é¡µé¢æ˜¾ç¤ºç›‘å¬ï¼Œtrue -> false  %{public}s")
        this.stopAnim()
        this.startAnim()
      } else {
        this.stopAnim()
      }
    }
  }

  onForeward() {
    if (this.proxyEnabled) {
      if(!this.isForeward) {
        // é¡µé¢ä¸å¤„äºå‰å°æ—¶æš‚åœè®¡æ—¶
        this.proxyStartedTimer.pause()
        hilog.info(0xFF00, "TimertestTag", "è®¡æ—¶å™¨æš‚åœæ­¤æ—¶çš„æ—¶é—´ï¼š%{private}s", this.proxyStartingDuration)
      } else {
        // äºŒæ¬¡å¯åŠ¨è®¡æ—¶
        let gapTime = this.theRestoreTime - this.thePauseTime
        hilog.info(0xFF00, "TimertestTag", "éœ€è¦å¢åŠ çš„æ—¶é—´ï¼š %{private}d", gapTime)
        this.proxyStartedTimer.resumeWithExtraTime(gapTime)
      }
    }
  }

}

export default Home

@Component
struct HomeCard {

  @Prop index: number
  @Prop item: HomeCardInfo
  @Consume rotateAngle : number
  // åˆ é™¤æŒ‰é’®æ˜¯å¦å‡ºç°åˆ¤å®š
  @Consume isShowDeleteButton: boolean
  // å½“å‰ä¸»é¡µå¸ƒå±€
  @Consume theCurrentHomeCard: boolean[]
  @StorageLink('uiConfig') uiConfig: UIConfig = new UIConfig()
  // å®½åº¦æ–­ç‚¹
  @StorageLink ('currentWidthBreakpoint') widthBp: WidthBreakpoint = 1
  // é«˜åº¦æ–­ç‚¹
  @StorageLink ('currentHeightBreakpoint') heightBp: HeightBreakpoint = 0

  build() {
    if (this.theCurrentHomeCard[this.index]) {
      GridCol({
        span: {
          sm: HomeCardSpan36sm(this.widthBp, this.heightBp) * (this.index == 0 || this.index == 7 ? 2 : 1),
          md: HomeCardSpan346md(this.widthBp, this.heightBp) * (this.index == 0 || this.index == 7 ? 2 : 1),
          lg: HomeCardSpan346lg(this.widthBp, this.heightBp) * (this.index == 0 || this.index == 7 ? 2 : 1)
        },
        // order: this.item.order
      })
      {
        Stack({ alignContent: Alignment.TopEnd }) {
          // Column() {
          //   Text(`å®é™…sm: ${HomeCardSpan36sm(this.widthBp, this.heightBp)} å®é™…md: ${HomeCardSpan346md(this.widthBp, this.heightBp)} å®é™…lg: ${HomeCardSpan346lg(this.widthBp, this.heightBp)}`)
          // }
          this.HomeCardContent(this.index)
          if (this.isShowDeleteButton) {
            DeleteButton()
              .position({ x: '95%', y: -4 })
              .onClick(() => {
                animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                  this.theCurrentHomeCard.splice(this.index, 1, false)
                })
                hilog.info(0xFF00, "HometestTag", "ç½‘ç»œé€Ÿç‡å¡ç‰‡: %{public}s", this.uiConfig.isShowHomeCard[this.index])
              })
          }
        }
      }.height(160)
      .borderRadius(20)
      .aspectRatio(this.item.aspectRatio)
      .backgroundColor($r('app.color.container_background'))/*.borderWidth(2).borderColor(Color.Red)*/
      .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
      .transition(customAnimationUtil.isScaleTran(1, this.uiConfig))
      // æ¶ˆå¤±è§¦å‘å›è°ƒ
      .onDetach(() => {})
      // æ˜¾ç¤ºæ—¶è§¦å‘å›è°ƒ
      .onAttach(() => {})
      // ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
      .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
    }
  }

  @Builder
  HomeCardContent(index: number) {
    if (index == 0) {
      Speed()
    } else if (index == 1) {
      SwitchMode()
    } else if (index == 2) {
      CellularData()
    } else if (index == 3) {
      CurrentNode()
    } else if (index == 4) {
      PublicNetwork()
    } else if (index == 5) {
      FavoriteProxy()
    } else if (index == 6) {
      FavoriteConfiguration()
    } else if (index == 7) {
      ProxyINFO()
    } else if (index == 8) {
      CurrentConfiguration()
    } else if (index == 9) {
      Shortcuts()
    }
  }

}

/**
 * ä¿å­˜æ ·å¼å’Œå†…å®¹å¼¹çª—æ§åˆ¶å™¨
 */
@CustomDialog
struct SaveCustomDialog {
  /* ä¸»é¢˜è‰² */
  @Consume('icon_emphasize') icon_emphasize: ResourceColor
  controller?: CustomDialogController
  /* æ˜¯å¦å¼€å¯ `Index` é¡µé¢çš„å‰æ™¯æ¨¡ç³Š */
  @Consume('isEnableIndexForegroundBlur') isEnableIndexForegroundBlur: boolean

  cancel: () => void = () => {
  }
  confirm: () => void = () => {
  }

  build() {
    Column() {
      Text($r('app.string.home_save_layout'))
        .fontSize(20)
        .fontColor($r('sys.color.font_primary'))

      Row() {
        Button($r('app.string.Give_Up'))
          .fontSize(16)
          .width(144)
          .fontColor(Color.Red)
          .backgroundColor('#00ffffff')
          .onClick(() => {
            if (this.controller != undefined) {
              this.controller.close()
            }
            this.cancel()
            this.isEnableIndexForegroundBlur = false
          })
        Blank(8)
        Button($r('app.string.Save'))
          .fontSize(16)
          .width(144)
          .backgroundColor(this.icon_emphasize)
          .onClick(() => {
            if (this.controller != undefined) {
              this.controller.close()
            }
            this.confirm()
            this.isEnableIndexForegroundBlur = false
          })
      }.padding({ top: 23 })
    }
    .width('100%')
    .height(undefined)
    .justifyContent(FlexAlign.Center)
    .backgroundColor($r('app.color.container_background'))
    .padding({ top: 16, bottom: 16 })
  }



}

// å°å¡ç‰‡å…±æœ‰å±æ€§
@Extend(GridCol)
function GridColStyle() {
  .aspectRatio(1)
  .borderRadius(20)
  .backgroundColor($r('app.color.container_background'))
}

// ç½‘ç»œæµ‹é€Ÿå¤§å¡ç‰‡é‡Œçš„åˆ é™¤æŒ‰é’®
@Component
struct DeleteButton {
  /* å½“å‰è®¾å¤‡`height`æ˜¯å¦ç¬¦åˆ(320vp< height <= 500vp) */
  @StorageLink ('isLandscapePhone') private isLandscapePhone: boolean = false
  // é«˜åº¦æ–­ç‚¹
  @StorageLink ('currentHeightBreakpoint') heightBp: HeightBreakpoint = 0
  // å®½åº¦æ–­ç‚¹
  @StorageLink ('currentWidthBreakpoint') widthBp: WidthBreakpoint = 1
  // æŠ˜å å±å±•å¼€çŠ¶æ€åˆ¤å®š
  @StorageLink ('isFoldStatus') private isFoldStatus: boolean = false
  @StorageLink('uiConfig') uiConfig: UIConfig = new UIConfig()

  build() {
    Button() {
      SymbolGlyph($r('sys.symbol.xmark'))
        .fontSize(16)
        .fontColor(['#fff'])
    }
    .borderRadius(20)
    .width(HomeCardDeleteButtonSize(this.widthBp, this.heightBp))
    .height(HomeCardDeleteButtonSize(this.widthBp, this.heightBp))
    .backgroundColor('#ffe84026')
    .transition(this.uiConfig.isAnimation ? TransitionEffect.scale({x: 0, y: 0}).animation({ duration: this.uiConfig.animationSpeed,curve:curves.springMotion() }):null)
  }
}


/*// ç½‘ç»œé€Ÿåº¦å°å¡ç‰‡
               if (this.theCurrentHomeCard[0]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 6 : 12,
                     sm: this.isLandscapePhone ? 6 : 12,
                     md: this.isLandscapePhone ? 6 : this.isFoldStatus ? 8 : 12,
                     lg: this.isFoldStatus ? 8 : this.isLandscapePhone || this.istabletLandscape ? 6 : 12
                   },
                   order: 1
                 })
                 {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     Speed()
                     if (this.isShowDeleteButton) {
                       DeleteButton1()
                         .position({ x: '95%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                             // å°†åºå·0å˜ä¸ºfalse
                             this.theCurrentHomeCard.splice(0, 1, false)
                           })
                           hilog.info(0xFF00, "HometestTag", "ç½‘ç»œé€Ÿç‡å¡ç‰‡ï¼š %{public}s",
                             this.uiConfig.isShowHomeCard[0])
                         })
                     }
                   }
                 }
                 .aspectRatio(2.07)
                 .borderRadius(20)
                 .backgroundColor($r('app.color.container_background'))
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .transition(customAnimationUtil.isScaleTran(1, this.uiConfig))
                 .height(this.isLandscapePhone ? '160vp' : this.HomeCardEditHeight.value)
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {})
                 // æ˜¾ç¤ºæ—¶è§¦å‘å›è°ƒ
                 .onAttach(() => {})
                 // ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
               }

               // åˆ†æµæ¨¡å¼å°å¡ç‰‡
               if (this.theCurrentHomeCard[1]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 3 : 6,
                     sm: this.isLandscapePhone ? 3 : 6,
                     md: this.isLandscapePhone ? 3 : this.isFoldStatus ? 4 : 6,
                     lg: this.isFoldStatus ? 4 : this.isLandscapePhone || this.istabletLandscape ? 3 : 6
                   },
                   order: 2
                 }) {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     SwitchMode()
                     if (this.isShowDeleteButton) {
                       DeleteButton2()
                         .position({ x: '90%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                             // å°†åºå·1å˜ä¸ºfalse
                             this.theCurrentHomeCard.splice(1, 1, false)
                           })
                           hilog.info(0xFF00, "HometestTag", "åˆ†æµæ¨¡å¼å¡ç‰‡ï¼š %{public}s",
                             this.uiConfig.isShowHomeCard[1])
                         })
                     }
                   }
                 }
                 .GridColStyle()
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .height(this.isLandscapePhone ? '160vp' : this.HomeCardEditHeight.value)
                 .transition(customAnimationUtil.isScaleTran(2, this.uiConfig))
                 //.transition(this.uiConfig.isAnimation ? TransitionEffect.scale({x: 0, y: 0}).animation({ duration: this.uiConfig.animationSpeed,delay:20 }):null)
                 //ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {
                 })
               }

               //æµé‡ç»Ÿè®¡å°å¡ç‰‡
               if (this.theCurrentHomeCard[2]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 3 : 6,
                     sm: this.isLandscapePhone ? 3 : 6,
                     md: this.isLandscapePhone ? 3 : this.isFoldStatus ? 4 : 6,
                     lg: this.isFoldStatus ? 4 : this.isLandscapePhone || this.istabletLandscape ? 3 : 6
                   },
                   order: 3
                 }) {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     CellularData()
                     if (this.isShowDeleteButton) {
                       DeleteButton2()
                         .position({ x: '90%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                             // å°†åºå·2å˜ä¸ºfalse
                             this.theCurrentHomeCard.splice(2, 1, false)
                           })
                         })
                     }
                   }
                 }
                 //   .margin({ left: this.containerMargin.value })
                 .GridColStyle()
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .height(this.isLandscapePhone ? '160vp' : this.HomeCardEditHeight.value)
                 .transition(customAnimationUtil.isScaleTran(3, this.uiConfig))
                 // .transition(this.uiConfig.isAnimation ? TransitionEffect.scale({x: 0, y: 0}).animation({ duration: this.uiConfig.animationSpeed,delay:30 }):null)
                 //ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {
                 })
               }

               //å½“å‰èŠ‚ç‚¹å°å¡ç‰‡
               if (this.theCurrentHomeCard[3]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 3 : 6,
                     sm: this.isLandscapePhone ? 3 : 6,
                     md: this.isLandscapePhone ? 3 : this.isFoldStatus ? 4 : 6,
                     lg: this.isFoldStatus ? 4 : this.isLandscapePhone || this.istabletLandscape ? 3 : 6
                   },
                   order: 4
                 }) {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     CurrentNode()
                     if (this.isShowDeleteButton) {
                       DeleteButton2()
                         .position({ x: '90%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                             // å°†åºå·3å˜ä¸ºfalse
                             this.theCurrentHomeCard.splice(3, 1, false)
                           })
                         })
                     }
                   }
                 }
                 .GridColStyle()
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .height(this.isLandscapePhone ? '160vp' : this.HomeCardEditHeight.value)
                 .transition(customAnimationUtil.isScaleTran(4, this.uiConfig))
                 //.transition(this.uiConfig.isAnimation ? TransitionEffect.scale({x: 0, y: 0}).animation({ duration: this.uiConfig.animationSpeed,delay:40 }):null)
                 //ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {

                 })
               }

               //IPåœ°å€å°å¡ç‰‡
               if (this.theCurrentHomeCard[4]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 3 : 6,
                     sm: this.isLandscapePhone ? 3 : 6,
                     md: this.isLandscapePhone ? 3 : this.isFoldStatus ? 4 : 6,
                     lg: this.isFoldStatus ? 4 : this.isLandscapePhone || this.istabletLandscape ? 3 : 6
                   },
                   order: 5
                 }) {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     PublicNetwork()
                     if (this.isShowDeleteButton) {
                       DeleteButton2()
                         .position({ x: '90%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                             // å°†åºå·4å˜ä¸ºfalse
                             this.theCurrentHomeCard.splice(4, 1, false)
                           })
                         })
                     }
                   }
                 }
                 .GridColStyle()
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .height(this.isLandscapePhone ? '160vp' : this.HomeCardEditHeight.value)
                 .transition(customAnimationUtil.isScaleTran(5, this.uiConfig))
                 // .transition(this.uiConfig.isAnimation ? TransitionEffect.scale({x: 0, y: 0}).animation({ duration: this.uiConfig.animationSpeed,delay:60 }):null)
                 //ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {
                 })
               }

               //æ”¶è—èŠ‚ç‚¹å°å¡ç‰‡
               if (this.theCurrentHomeCard[5]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 3 : 6,
                     sm: this.isLandscapePhone ? 3 : 6,
                     md: this.isLandscapePhone ? 3 : this.isFoldStatus ? 4 : 6,
                     lg: this.isFoldStatus ? 4 : this.isLandscapePhone || this.istabletLandscape ? 3 : 6
                   },
                   order: 6
                 }) {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     FavoriteProxy()
                     if (this.isShowDeleteButton) {
                       DeleteButton2()
                         .position({ x: '90%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                             // å°†åºå·5å˜ä¸ºfalse
                             this.theCurrentHomeCard.splice(5, 1, false)
                           })
                         })
                     }
                   }
                 }
                 .GridColStyle()
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .height(this.isLandscapePhone ? '160vp' : this.HomeCardEditHeight.value)
                 .transition(customAnimationUtil.isScaleTran(6, this.uiConfig))
                 //.transition(this.uiConfig.isAnimation ? TransitionEffect.scale({x: 0, y: 0}).animation({ duration: this.uiConfig.animationSpeed,delay:70 }):null)
                 //ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {
                 })
               }

               //æ”¶è—é…ç½®å°å¡ç‰‡
               if (this.theCurrentHomeCard[6]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 3 : 6,
                     sm: this.isLandscapePhone ? 3 : 6,
                     md: this.isLandscapePhone ? 3 : this.isFoldStatus ? 4 : 6,
                     lg: this.isFoldStatus ? 4 : this.isLandscapePhone || this.istabletLandscape ? 3 : 6
                   },
                   order: 7
                 }) {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     FavoriteConfiguration()
                     if (this.isShowDeleteButton) {
                       DeleteButton2()
                         .position({ x: '90%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                             // å°†åºå·6å˜ä¸ºfalse
                             this.theCurrentHomeCard.splice(6, 1, false)
                           })
                         })
                     }
                   }
                 }
                 .GridColStyle()
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .height(this.isLandscapePhone ? '160vp' : this.HomeCardEditHeight.value)
                 .transition(customAnimationUtil.isScaleTran(7, this.uiConfig))
                 // .transition(this.uiConfig.isAnimation ? TransitionEffect.scale({x: 0, y: 0}).animation({ duration: this.uiConfig.animationSpeed,delay:80 }):null)
                 //ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {
                 })
               }

               // èŠ‚ç‚¹ä¿¡æ¯å°å¡ç‰‡
               if (this.theCurrentHomeCard[7]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 6 : 12,
                     sm: this.isLandscapePhone ? 6 : 12,
                     md: this.isLandscapePhone ? 6 : this.isFoldStatus ? 8 : 12,
                     lg: this.isFoldStatus ? 8 : this.isLandscapePhone || this.istabletLandscape ? 6 : 12
                   },
                   order: this.isFoldStatus ? 3 : 1
                 }) {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     ProxyINFO()
                     if (this.isShowDeleteButton) {
                       DeleteButton1()
                         .position({ x: '95%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                             // å°†åºå·7å˜ä¸ºfalse
                             this.theCurrentHomeCard.splice(7, 1, false)
                           })
                         })
                     }
                   }
                 }
                 .aspectRatio(2.07)
                 .borderRadius(20)
                 .backgroundColor($r('app.color.container_background'))
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .transition(customAnimationUtil.isScaleTran(8, this.uiConfig))
                 .height(this.isLandscapePhone ? '160vp' : this.HomeCardEditHeight.value)
                 //ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {
                 })
               }

               //å½“å‰é…ç½®å°å¡ç‰‡
               if (this.theCurrentHomeCard[8]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 3 : 6,
                     sm: this.isLandscapePhone ? 3 : 6,
                     md: this.isLandscapePhone ? 3 : this.isFoldStatus ? 4 : 6,
                     lg: this.isFoldStatus ? 4 : this.isLandscapePhone || this.istabletLandscape ? 3 : 6
                   },
                   order: 4
                 }) {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     CurrentConfiguration()
                     if (this.isShowDeleteButton) {
                       DeleteButton2()
                         .position({ x: '90%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                             // å°†åºå·8å˜ä¸ºfalse
                             this.theCurrentHomeCard.splice(8, 1, false)
                           })
                         })
                     }
                   }
                 }
                 .GridColStyle()
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .height(this.isLandscapePhone ? '160vp' : this.HomeCardEditHeight.value)
                 // .transition(this.uiConfig.isAnimation ? TransitionEffect.scale({x: 0, y: 0}).animation({ duration: this.uiConfig.animationSpeed ,delay:50}):null)
                 .transition(customAnimationUtil.isScaleTran(9, this.uiConfig))
                 //ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {
                 })
               }

               //å¿«æ·æ–¹å¼å°å¡ç‰‡
               if (this.isFoldStatus && !this.is2in1 ? !this.theCurrentHomeCard[9] : this.theCurrentHomeCard[9]) {
                 GridCol({
                   span: {
                     xs: this.isLandscapePhone ? 3 : 6,
                     sm: this.isLandscapePhone ? 3 : 6,
                     md: this.isLandscapePhone ? 3 : this.isFoldStatus ? 4 : 6,
                     lg: this.isFoldStatus ? 4 : this.isLandscapePhone || this.istabletLandscape ? 3 : 6
                   },
                   order: 8
                 }) {
                   Stack({ alignContent: Alignment.TopEnd }) {
                     Shortcuts()
                     if (this.isShowDeleteButton) {
                       DeleteButton2()
                         .position({ x: '90%', y: -4 })
                         .onClick(() => {
                           animateTo({ duration: this.uiConfig.animationSpeed, curve: Curve.Linear }, () => {
                               // å°†åºå·9å˜ä¸ºfalse
                               this.theCurrentHomeCard.splice(9, 1,this.isFoldStatus && !this.is2in1 ? true : false)
                             console.info('å¿«æ·å¡ç‰‡åˆ¤å®š',this.theCurrentHomeCard[9])
                           })
                         })
                         .onAppear(()=>{
                           console.info('å¿«æ·å¡ç‰‡åˆ¤å®š',this.theCurrentHomeCard[9])
                         })
                     }
                   }
                 }
                 .GridColStyle()
                 .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                 .height(this.isLandscapePhone ? '100vp' : this.HomeCardEditHeight.value)
                 .transition(customAnimationUtil.isScaleTran(10, this.uiConfig))
                 // .transition(this.uiConfig.isAnimation ? TransitionEffect.scale({x: 0, y: 0}).animation({ duration: this.uiConfig.animationSpeed ,delay:90}):null)
                 //ç¼–è¾‘æ¨¡å¼ä¸‹è·³åŠ¨åŠ¨ç”»
                 .rotate({ angle: this.uiConfig.isAnimation ? this.rotateAngle : null })
                 // æ¶ˆå¤±è§¦å‘å›è°ƒ
                 .onDetach(() => {
                 })
               }*/

