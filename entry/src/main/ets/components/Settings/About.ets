import { BreakpointState } from "../../common/breakpointsystem"
import { AboutListItemProp, BORDER_RADIUS_20, ContributorsListItemProp,
  ContributorsList,
  CheckUpdateListItemProp,
  CONTENT_END_OFFSET_150,
  moreData,
  ListMoreData,
  getAboutList,
  getCheckUpdateList,
  TCItemProp,
  FAQList,
  ThirdServicesList,
  UseGuidanceList,
  LinkList,
} from "../../common/Constants"
import TopBuilder from "./TopBuilder"
import { hilog } from "@kit.PerformanceAnalysisKit"
import { common, Want } from "@kit.AbilityKit"
import { BusinessError } from "@kit.BasicServicesKit"
import { promptAction, SymbolGlyphModifier } from "@kit.ArkUI"
import { AppConfig, ClashCore, isEnd, UIConfig } from "../../entryability/AppState"
import { customAnimationUtil } from "../../utils/Animation"
import { removeItemsByIndex } from "../../utils/RemoveItemsUtils"
import { customVibrator } from "../../utils/VibratorUtil"
import { customSound } from "../../utils/SoundPoolUtil"
import { getResourceString } from "../../utils/ResourceStringUtil"
import { extractUpdateInfo, getUpdateInfo, UpdateInfo } from "../../utils/CheckUpdateUtil"
import { handleMailto } from "../../utils/MailTwoUtil"

const context = getContext(this) as common.UIAbilityContext

@Component
struct About {
  // å®éªŒåŠŸèƒ½æç¤ºæ¡†å±•ç¤ºå˜é‡
  @Consume isShowExperimentalFunction: boolean
  // ä¸»é¢˜è‰²
  @Consume('icon_emphasize') icon_emphasize: ResourceColor
  // ä¸€çº§å›¾æ ‡è‰²ï¼Œé»‘è‰²
  @State icon_primary: ResourceColor = $r('sys.color.icon_primary')
  // äºŒçº§å›¾æ ‡è‰²ï¼Œé»‘è‰²
  @State icon_secondary: ResourceColor = $r('sys.color.icon_secondary')
  @State EnableUpdateChenChannels: number = 0
  @State aboutList: AboutListItemProp[] = []
  // æ›´å¤šé¡µåˆ—è¡¨æ•°ç»„
  @Consume moreList: moreData[]
  @Consume('NavSettingsPathStack') SettingsPageInfos: NavPathStack
  @Consume('breakPointStatemorePageMargin') breakPointStatemorePageMargin: BreakpointState<number>
  @StorageLink('uiConfig') uiConfig: UIConfig = new UIConfig()
  @StorageLink('appConfig') appConfig: AppConfig = new AppConfig()
  @StorageProp('isLandscapePhone')  private isLandscapePhone: boolean = false
  // ç‚¹å‡»æ¬¡æ•°
  @State clickCount: number = 0
  // å®éªŒåŠŸèƒ½å¼€å…³åˆ—è¡¨è¡Œæ•°æ®
  @Consume ExperimentData: AboutListItemProp
  @Consume theAppVersionInfo: UpdateInfo

  onClickCount() {
    //æŒ¯åŠ¨è§¦å‘
    if (this.uiConfig.isVibrate) {
      customVibrator.vibratorTriggerOfHapticClockTimer()
    }
    hilog.info(0xFF00, "AboutClickTag", "ç‚¹å‡»æ¬¡æ•°: %{public}d", this.clickCount)
    if(this.uiConfig.enabledADvanced) {
      promptAction.showToast({message: 'å·²å¤„äºé«˜çº§æ¨¡å¼' /*$r('app.string.click_prompt')*/, duration: 2000 })
    } else {
      if (this.clickCount >= 5) {
        this.uiConfig.enabledADvanced = true
        this.uiConfig.isShowExperimentalFunction = true
        // åˆ·æ–°å…³äºé¡µé¢æ•°æ®
        this.aboutList.splice(1, 0, this.ExperimentData)
        // åˆ·æ–°æ›´å¤šé¡µé¢æ•°æ®
        this.moreList = ListMoreData()
        promptAction.showToast({message: 'é«˜çº§æ¨¡å¼å·²å¼€å¯' /*$r('app.string.click_prompt')*/, duration: 2000 })
        //éŸ³æ•ˆè§¦å‘
        customSound.playAudioForSoundPool()
      } else if (this.clickCount === 3) {
        promptAction.showToast({message: 'ä»€ä¹ˆä¸œè¥¿é—ªè¿‡å»äº†' /*$r('app.string.click_prompt')*/, duration: 1000 })
      }
    }
  }

  // åˆ—è¡¨è¡Œè·³è½¬å¤„ç†
  handleCheck(name?: string) {
    switch (name) {
      case 'Update':
        // æ£€æŸ¥æ›´æ–°
        hilog.info(0xFF00, "AboutestTag", "æ£€æŸ¥æ›´æ–°")

      break
      case 'Telegram':
        // è·³è½¬Telegramé¢‘é“
        hilog.info(0xFF00, "AboutestTag", "Telegram")
        implicitStartAbility('https://t.me/+ihe73JZWYb40NTY1', context)

      break
      case 'Discord':
        // è·³è½¬Discordç¤¾åŒº
        hilog.info(0xFF00, "AboutestTag", "Discord")
        implicitStartAbility('https://discord.gg/mZarq2EQmm', context)

      break
      case 'Email':
        // ç”µå­é‚®ä»¶
        hilog.info(0xFF00, "AboutestTag", "Email")
        handleMailto('mailto:xfz347@gmail.com?subject=åé¦ˆ&body=ä½ çš„åé¦ˆå†…å®¹...', context)
      break
      case 'Repositories':
        // è·³è½¬ä»“åº“
        hilog.info(0xFF00, "AboutestTag", "ä»“åº“")
        implicitStartAbility('https://github.com/xxx%%', context)

      break
      default :
        this.SettingsPageInfos.pushPathByName(name, false)
    }
  }

  // åˆ—è¡¨è¡Œå¼€å…³äº‹ä»¶å¤„ç†
  handleToggle(isOn: boolean, name: string) {
    switch (name) {
      case 'ExperimentalFunction':
        // å®éªŒåŠŸèƒ½å¼€å…³
        // æŒä¹…åŒ–å®éªŒåŠŸèƒ½å¼€å…³çŠ¶æ€
        this.uiConfig.isShowExperimentalFunction = isOn
        hilog.info(0xFF00, "AboutestTag", "å®éªŒåŠŸèƒ½")
        if(isOn) {
          this.isShowExperimentalFunction = true
          // æ˜¾ç¤ºåˆ†æµç­–ç•¥
          this.moreList = ListMoreData()
        } else {
          this.isShowExperimentalFunction = false
          // å±è”½åˆ†æµç­–ç•¥
          // this.moreList = removeItemsByIndex(this.moreList, [5])
        }
        break
      case 'Auto':
      // è‡ªåŠ¨æ£€æŸ¥æ›´æ–°
      hilog.info(0xFF00, "AboutestTag", "è‡ªåŠ¨æ£€æŸ¥æ›´æ–°")
      this.uiConfig.autoCheckUpdate = isOn
    }
  }

  // æ›´æ–°æ¸ é“æ›´æ”¹å¤„ç†
  switchUpdateChenChannels(index: number) {
    hilog.info(0xFF00, "AboutUpdateTag", "index: %{public}d", index)
    switch (index) {
      case 0:
        // Github
        hilog.info(0xFF00, "AboutUpdateTag", "Github")

      break
      case 1:
        // XXX
        hilog.info(0xFF00, "AboutUpdateTag", "XXX")

      break
      case 2:
        // XXXX
        hilog.info(0xFF00, "AboutUpdateTag", "XXXX")

      break

    }
  }

  // åˆ·æ–°æ›´æ–°æ¸ é“åˆ—è¡¨UI TODO ã€ç”¨æˆ·é¦–é€‰é¡¹ã€‘ä¿å­˜é€‰æ‹©çš„æ›´æ–°æ¸ é“ Ya@2024-12-20
  refreshUpdateChenChannels(title: ResourceStr) {
    // ä¿®æ”¹å…³äºé¡µé¢æ›´æ–°æ¸ é“æ˜¾ç¤ºçš„subtitle
    // å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨children
    const childItem = this.aboutList[4]
    if (childItem && childItem.children) {
      childItem.children[1].subtitle = title
      // ä½¿ç”¨spliceæ¥æ›´æ–°çˆ¶ç»„ä»¶æ•°ç»„
      this.aboutList.splice(4, 1, childItem)
    }
  }
  // åˆ·æ–°å®éªŒåŠŸèƒ½å¯ç”¨å¼€å…³çŠ¶æ€
  refreshShowExperimentalFunction(isOn: boolean) {
    const showItem = this.aboutList[1]
    if (showItem && showItem.children) {
      showItem.children[0].isOn = isOn
      // ä½¿ç”¨spliceæ¥æ›´æ–°çˆ¶ç»„ä»¶æ•°ç»„
      this.aboutList.splice(1, 1, showItem)
    }
  }
  // åˆ·æ–°å†…æ ¸ç‰ˆæœ¬ä¿¡æ¯æ˜¾ç¤º
  refreshShowKernelVersion(kernel?: ClashCore) {
    hilog.info(0xFF00, "SettingsKerneltestTag", "å½“å‰æ˜¾ç¤ºå†…æ ¸ï¼š%{public}d", this.appConfig.clashCore)
    const showItem = this.aboutList[0]
    if (showItem && showItem.children) {
      switch (kernel) {
        case 0:
          showItem.children[1].subtitle = `FlClash ${showItem.children[1].subtitle}`
          break
        case 1:
          showItem.children[1].subtitle = `FlClash(å‰å°æ¨¡å¼) ${showItem.children[1].subtitle}`
          break
        case 2:
          showItem.children[1].subtitle = `ClashRS ${showItem.children[1].subtitle}`
          break
      }
      // ä½¿ç”¨spliceæ¥æ›´æ–°çˆ¶ç»„ä»¶æ•°ç»„
      this.aboutList.splice(0, 1, showItem)
    }
  }
  // åˆ·æ–°è‡ªåŠ¨æ£€æŸ¥æ›´æ–°å¯ç”¨å¼€å…³çŠ¶æ€
  refreshShowAutoUpdate(isOn: boolean) {
    const showItem = this.aboutList[4]
    if (showItem && showItem.children) {
      showItem.children[2].isOn = isOn
      // ä½¿ç”¨spliceæ¥æ›´æ–°çˆ¶ç»„ä»¶æ•°ç»„
      this.aboutList.splice(4, 1, showItem)
    }
  }

  // æ›´æ–°æ¸ é“èœå•
  @Builder
  UpdateMenu(item: AboutListItemProp[], index: number) {
    Menu() {
      ForEach(item, (menuItem: AboutListItemProp, index: number) => {
        MenuItem({
          content: menuItem.title,
          symbolEndIcon: this.EnableUpdateChenChannels === index ? new SymbolGlyphModifier($r('sys.symbol.checkmark')) : undefined
        })
          .selected(this.EnableUpdateChenChannels === index)
          .onChange((selected) => {
            this.switchUpdateChenChannels(index)
            this.EnableUpdateChenChannels = index
            // UIåˆ·æ–°
            this.refreshUpdateChenChannels(menuItem.title)
          })
      }, (menuItem: AboutListItemProp) => JSON.stringify(menuItem))
    }
  }

  aboutToAppear(): void {
    this.aboutList = getAboutList()
    // éŸ³æ•ˆ
    customSound.initSoundPool(3, 'di.mp3')
    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–å®éªŒåŠŸèƒ½å¯ç”¨çŠ¶æ€
    this.refreshShowExperimentalFunction(this.uiConfig.isShowExperimentalFunction)
    // åŠ è½½æ—¶åˆå§‹åŒ–å†…æ ¸ç‰ˆæœ¬æ˜¾ç¤º
    this.refreshShowKernelVersion(this.appConfig.clashCore)
    // åŠ è½½æ—¶åˆå§‹åŒ–è‡ªåŠ¨æ£€æŸ¥æ›´æ–°å¼€å…³çŠ¶æ€
    this.refreshShowAutoUpdate(this.uiConfig.autoCheckUpdate)
    hilog.info(0xFF00, "AboutClickTag", "é«˜çº§åŠŸèƒ½: %{public}s", this.uiConfig.enabledADvanced)
    if (this.uiConfig.enabledADvanced === false && this.aboutList.length === 7) {
      this.aboutList = removeItemsByIndex(this.aboutList, [1])
    }
  }
  aboutToDisappear(): void {
    this.isShowExperimentalFunction = this.uiConfig.isShowExperimentalFunction
    customSound.destroySoundPool()
  }

  build() {
    NavDestination() {
      // æ ‡é¢˜
      TopBuilder({title: $r('app.string.About')})
      // Listä¸»ä½“
      List() {
        // Logo&åç§°
        ListItem() {
          Column() {
            Stack() {
              Image($r('app.media.foreground'))
                .height(160)
                .zIndex(2)
              Stack() {
                Image($r('app.media.About_name_1'))
                  .width(192)
                  .fillColor($r('app.color.symbol_logo_name_color'))
                Image($r('app.media.About_name_2'))
                  .height(26)
                  .offset({x: 51, y: -1})
              }
              .offset({y: 86})
            }
          }
          .justifyContent(FlexAlign.Start)
          .alignItems(HorizontalAlign.Center)
          .width('100%')
          .backgroundColor($r('app.color.container_background'))
          .borderRadius(BORDER_RADIUS_20)
          .height(220)
        }
        .margin({bottom: 10 })
           .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))

        ForEach(this.aboutList, (item: AboutListItemProp, index: number) => {
          ListItem() {
            Column() {
              ForEach(item.children, (itemChild: AboutListItemProp, i: number) => {
                if (itemChild.children) {
                  // å­˜åœ¨å­é¡¹
                  Column() {
                    Row() {
                      Text(itemChild.title)
                        .height(53)
                        .fontWeight(FontWeight.Medium)
                        .padding({ left: 12 })
                        .fontSize(16)
                      Blank()
                      Row() {
                        Text(itemChild.subtitle)
                          .fontWeight(FontWeight.Normal)
                          .fontSize(14)
                          .margin({right: 5})
                        SymbolGlyph($r('sys.symbol.arrowtriangle_down_fill'))
                          .fontSize(14)
                          .fontColor([this.icon_primary])
                          .margin({left: 7})
                      }.margin({right: 20})
                       .bindMenu(this.UpdateMenu(itemChild.children, index))
                    }.width('100%')
                    // åˆ†å‰²çº¿
                    if(!isEnd(item.children!.length,i))
                      Row().height(0.5).backgroundColor($r('app.color.divider')).width('93%')

                  }
                     .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                  .onClick(() => {
                    // è¿™é‡Œä»€ä¹ˆéƒ½æ²¡æœ‰
                  })
                } else { // æ— å­é¡¹
                  Column() {
                    Row() {
                      Column() {
                        Text(itemChild.title)
                          .fontWeight(FontWeight.Medium)
                          .fontSize(16)
                        if(itemChild.subtitle && itemChild.sign === 1) {
                          Text(itemChild.subtitle)
                            .fontWeight(FontWeight.Normal)
                            .fontSize(14)
                            .margin({top: 2})
                        }
                      }
                      .height(53)
                      .justifyContent(FlexAlign.Center)
                      .alignItems(HorizontalAlign.Start)
                      .margin({ left: 12 })
                      Blank()
                      if(itemChild.sign === 1) {
                        // å¼€å…³å‹
                        Toggle({ type: ToggleType.Switch, isOn: itemChild.isOn })
                          .selectedColor(this.icon_emphasize)
                          .margin({right: 12})
                          .onChange((isOn: boolean) => {
                            // è¿›å…¥å¼€å…³äº‹ä»¶å¤„ç†
                            this.handleToggle(isOn, itemChild.name)
                          })
                      } else if(itemChild.sign === 2) {
                        // è·³è½¬å‹
                        SymbolGlyph($r('sys.symbol.chevron_right'))
                          .fontSize(28)
                          .margin({right: 12})
                          .fontColor([this.icon_primary])
                      } else if(itemChild.sign === 0) {
                        // æ™®é€šå‹
                        Text(itemChild.subtitle)
                          .fontWeight(FontWeight.Normal)
                          .fontSize(14)
                          .margin({right: 12})
                          .hitTestBehavior(HitTestMode.None)
                      }
                    }.width('100%')
                    // åˆ†å‰²çº¿
                   if(!isEnd(item.children!.length,i))
                     Row().height(0.5).backgroundColor($r('app.color.divider')).width('93%')

                  }
                  .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                  .onClick(() => {
                   if(itemChild.sign === 1) {
                     // ç‚¹å‡»æç¤º é˜²è¯¯è§¦
                     promptAction.showToast({message: $r('app.string.click_prompt'), duration: 2000 })
                      if (itemChild.name === 'ExperimentalFunction') {

                      // } else {
                      //   // æ”¹å˜è‡ªåŠ¨æ£€æŸ¥æ›´æ–°å¼€å…³çŠ¶æ€ æ˜¾å¼åŠ¨ç”»
                      //   this.getUIContext()?.animateTo({
                      //     duration: this.uiConfig.animationSpeed,
                      //     curve: Curve.Ease
                      //   }, () => {
                      //     const childItem = this.aboutList[4]
                      //     if (childItem && childItem.children) {
                      //       childItem.children[2].isOn = !childItem.children[2].isOn
                      //       // ä½¿ç”¨spliceæ¥æ›´æ–°çˆ¶ç»„ä»¶æ•°ç»„
                      //       this.aboutList.splice(4, 1, childItem)
                      //     }
                      //   })
                      }

                    } else if (itemChild.sign === 2) {
                      // è¿›å…¥åˆ—è¡¨è¡Œè·³è½¬å¤„ç†
                      this.handleCheck(itemChild.name)
                    } else if (itemChild.sign === 0) {
                     if (itemChild.name === 'ApplicationVersion') {
                       hilog.info(0xFF00, "AboutClickTag", "å‰: %{public}d", this.clickCount)
                       this.clickCount++
                       this.onClickCount()
                       hilog.info(0xFF00, "AboutClickTag", "å: %{public}d", this.clickCount)
                     }
                   }
                  })
                }
              }, (itemChild: AboutListItemProp) => itemChild.name )
            }
            .backgroundColor($r('app.color.container_background'))
            .borderRadius(BORDER_RADIUS_20)
            .margin({bottom: 10 })
          }

        })
      }
      .width('100%')
      .alignListItem(ListItemAlign.Center)
      .contentEndOffset(CONTENT_END_OFFSET_150 - 85)
      .padding({ left: this.breakPointStatemorePageMargin.value, right: this.breakPointStatemorePageMargin.value })
    }
    .width('100%')
    .backgroundColor($r('app.color.background'))
    .hideTitleBar(true)
    .onBackPressed(() => {
      this.SettingsPageInfos.clear()
      return true
    })
  }
}
export default About



/**
 *  è´¡çŒ®è€…åå•é¡µé¢
 */
@Component
export struct AboutContributors {
  /* ä¸»é¢˜è‰² */
  @Consume('icon_emphasize') icon_emphasize: ResourceColor
  @State ContributorsList: ContributorsListItemProp[] = ContributorsList
  @Consume('NavSettingsPathStack') SettingsPageInfos: NavPathStack
  @StorageProp('isLandscapePhone')  private isLandscapePhone: boolean = false
  @StorageLink('uiConfig') uiConfig: UIConfig = new UIConfig()
  // åˆ—è¡¨é«˜åº¦
  @Consume('breakPointStateSettingslistHeight') private SettingslistHeight: BreakpointState<number>
  @Consume('breakPointStatemorePageMargin') breakPointStatemorePageMargin: BreakpointState<number>

  handleClick(index: number) {
    switch (index) {
      case 0:
        // å°ç™½
        implicitStartAbility('https://github.com/likuai2010', context)
      break
      case 1:
        // èˆ¹é•¿
        handleMailto('mailto:xfz347@gmail.com?subject=è”ç³»&body=ä½ çš„å†…å®¹...', context)
      break
      case 2:
        // æŸ¯è“KL
        implicitStartAbility('https://github.com/kelanKL', context)
      break
      case 3:
        // æ©ä¸´å¤§å¸
        handleMailto('mailto:ealion@outlook.com?subject=è”ç³»&body=ä½ çš„å†…å®¹...', context)
      break
      case 4:
        // crazypig321
        implicitStartAbility('https://github.com/crazypig321', context)
      break
      /*case 5:
        // é±¼ğŸŸ
        // implicitStartAbility('https://github.com/yu', context)
        break*/
      case 5:
        // å°é›…
        handleMailto('mailto:xytdg520@qq.com?subject=è”ç³»&body=ä½ çš„å†…å®¹...', context)
      break
      case 6:
        // FlClash
        implicitStartAbility('https://github.com/chen08209/FlClash', context)
      break
    }
  }

  build() {
    NavDestination() {
      TopBuilder({title: $r('app.string.About'), subtitle: $r('app.string.Contributors')})
      List() {
        ForEach(this.ContributorsList, (item: ContributorsListItemProp, index: number) => {
          ListItem() {
            Column() {
              Row() {
                // å¤´åƒ
                Image(item.image)
                  .width(48)
                  .height(48)
                  .borderRadius(100)
                  .interpolation(ImageInterpolation.High)
                  .transition(customAnimationUtil.isScaleTranIcon(10,this.uiConfig))
                Column() {
                  // åå­—
                  Text(item.title)
                    .fontSize(20)
                    .fontWeight(FontWeight.Bold)
                  Text(item.subtitle)
                    .textOverflow({ overflow: TextOverflow.Ellipsis })
                    .maxLines(1)
                    .fontSize(16)
                    .fontWeight(FontWeight.Normal)
                    .margin({top: 2})
                }
                .alignItems(HorizontalAlign.Start)
                .margin({left: 16})
              }
              .width('100%')
              .justifyContent(FlexAlign.Start)

              if(item.contact) {
                Row() {
                  Button(item.contact, { type: ButtonType.Capsule, stateEffect: true })
                    .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                    .backgroundColor($r('app.color.button_container_background'))
                    .fontColor(this.icon_emphasize)
                    .width(90)
                    .height(26)
                    .onClick(() => {
                      this.handleClick(index)
                    })
                  if(item.contact2) {
                    Button(item.contact2, { type: ButtonType.Capsule, stateEffect: true })
                           .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
                      .backgroundColor($r('app.color.button_container_background'))
                      .fontColor(this.icon_emphasize)
                      .margin({left: 6})
                      .width(90)
                      .height(26)
                      .onClick(() => {
                        // æŸ¯è“KL Telegram
                        implicitStartAbility('https://xxxx', context)
                      })
                  }
                }
                .margin({top: 12})
                .width('100%')
                .justifyContent(FlexAlign.Start)
              }
            }
          }
          .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
          .backgroundColor($r('app.color.container_background'))
          .borderRadius(BORDER_RADIUS_20)
          .margin({bottom: 10 })
          .width('100%')
          .padding({left: 12, top: 12, bottom: 12})
        })
      }
      .width('100%')
      .alignListItem(ListItemAlign.Center)
      .contentEndOffset(CONTENT_END_OFFSET_150 - 85)
      .padding({ left: this.breakPointStatemorePageMargin.value, right: this.breakPointStatemorePageMargin.value })
    }.width('100%')
    .backgroundColor($r('app.color.background'))
    .hideTitleBar(true)
    .onBackPressed(() => {
      this.SettingsPageInfos.pop(true)
      return true
    })
  }
}

/**
 *  ä¸‰æ–¹åº“ä¸æœåŠ¡
 */
@Component
export struct ThirdServices {
  /* ä¸»é¢˜è‰² */
  @Consume('icon_emphasize') icon_emphasize: ResourceColor
  @State thirdServicesList: TCItemProp[] = ThirdServicesList
  @Consume('NavSettingsPathStack') SettingsPageInfos: NavPathStack
  @StorageProp('isLandscapePhone')  private isLandscapePhone: boolean = false
  @StorageLink('uiConfig') uiConfig: UIConfig = new UIConfig()
  @Consume('breakPointStatemorePageMargin') breakPointStatemorePageMargin: BreakpointState<number>

  build() {
    NavDestination() {
      TopBuilder({title: $r('app.string.About'), subtitle: $r('app.string.third_party_services')})
      List({space: 10}) {
        ForEach(this.thirdServicesList, (item: TCItemProp, index: number) => {
          ListItem() {
            Column() {
              // é¡¹ç›®
              Text(`${getResourceString($r('app.string.Name'), this)}: ${item.title}`)
                .fontSize(17)
                .fontWeight(FontWeight.Medium)
              // å†…å®¹
              Text(`${getResourceString($r('app.string.project'), this)}: ${item.content}`)
                .textOverflow({ overflow: TextOverflow.Ellipsis })
                .maxLines(1)
                .fontSize(17)
                .fontWeight(FontWeight.Normal)
                .margin({top: 2})
            }.width('100%')
            .margin({left: 12})
            .alignItems(HorizontalAlign.Start)
          }
          .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
          .backgroundColor($r('app.color.container_background'))
          .borderRadius(BORDER_RADIUS_20)
          .width('100%')
          .padding({left: 12, top: 12, bottom: 12})
          .onClick(() => {
            implicitStartAbility(getResourceString(item.content, this), context)
          })
        }, (item: TCItemProp) => getResourceString(item.title, this))
      }
      .width('100%')
      .alignListItem(ListItemAlign.Center)
      .contentEndOffset(CONTENT_END_OFFSET_150 - 85)
      .padding({ left: this.breakPointStatemorePageMargin.value, right: this.breakPointStatemorePageMargin.value })
    }.width('100%')
    .backgroundColor($r('app.color.background'))
    .hideTitleBar(true)
    .onBackPressed(() => {
      this.SettingsPageInfos.pop(true)
      return true
    })
  }
}

/**
 *  ä½¿ç”¨å¼•å¯¼
 */
@Component
export struct UseGuidance {
  /* ä¸»é¢˜è‰² */
  @Consume('icon_emphasize') icon_emphasize: ResourceColor
  @State useGuidanceList: TCItemProp[] = UseGuidanceList
  @Consume('NavSettingsPathStack') SettingsPageInfos: NavPathStack
  @StorageProp('isLandscapePhone')  private isLandscapePhone: boolean = false
  @StorageLink('uiConfig') uiConfig: UIConfig = new UIConfig()
  @Consume('breakPointStatemorePageMargin') breakPointStatemorePageMargin: BreakpointState<number>

  build() {
    NavDestination() {
      TopBuilder({title: $r('app.string.About'), subtitle: $r('app.string.UseGuidance')})
      List({space: 10}) {
        ForEach(this.useGuidanceList, (item: TCItemProp, index: number) => {
          ListItem() {
            Column() {
              // é¡¹ç›®
              Row() {
                Text('Â·')
                  .fontSize(32)
                  .fontWeight(FontWeight.Bolder)
                Text() {
                  Span(item.title)
                    .fontSize(17)
                    .fontWeight(FontWeight.Medium)
                }
              }.alignItems(VerticalAlign.Center)
              // å†…å®¹
              Image(item.content)
                .height(169)
                .width('100%')
                .borderRadius(BORDER_RADIUS_20)
            }.width('100%')
            .alignItems(HorizontalAlign.Start)
          }
          .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
          .backgroundColor($r('app.color.container_background'))
          .borderRadius(BORDER_RADIUS_20)
          .width('100%')
          .padding(12)
        }, (item: TCItemProp) => getResourceString(item.title, this))
      }
      .width('100%')
      .alignListItem(ListItemAlign.Center)
      .contentEndOffset(CONTENT_END_OFFSET_150 - 65)
      .padding({ left: this.breakPointStatemorePageMargin.value, right: this.breakPointStatemorePageMargin.value })
    }.width('100%')
    .backgroundColor($r('app.color.background'))
    .hideTitleBar(true)
    .onBackPressed(() => {
      this.SettingsPageInfos.pop(true)
      return true
    })
  }
}

/**
 *  å¸¸è§é—®é¢˜
 */
@Component
export struct FAQ {
  @State FAQlist: TCItemProp[] = FAQList
  @State linkList: TCItemProp[] = LinkList
  /* ä¸»é¢˜è‰² */
  @Consume('icon_emphasize') icon_emphasize: ResourceColor
  @Consume('NavSettingsPathStack') SettingsPageInfos: NavPathStack
  // ä¸€çº§å›¾æ ‡è‰²ï¼Œé»‘è‰²
  @State icon_primary: ResourceColor = $r('sys.color.icon_primary')
  @Consume('breakPointStatemorePageMargin') breakPointStatemorePageMargin: BreakpointState<number>

  build() {
    NavDestination() {
      TopBuilder({title: $r('app.string.About'), subtitle: $r('app.string.FAQ')})
      List({space: 10}) {
        ListItem() {
          Row({space: 10}) {
            SymbolGlyph($r('sys.symbol.info_circle'))
              .fontSize(24)
              .margin({left: 7})
              .fontColor([this.icon_primary])
            Flex({
              alignContent: FlexAlign.Start,
              direction: FlexDirection.Row,
              wrap: FlexWrap.Wrap,
            }) {
              Text() {
                Span($r('app.string.statement'))
                Span($r('app.string.third_party_services'))
                  .fontColor(this.icon_emphasize)
                  .onClick(() => {
                    this.SettingsPageInfos.pushPathByName('Three', false)
                  })
                Span($r('app.string.statement_1'))
              }
            }.width('88%')
          }.width('100%')
          .justifyContent(FlexAlign.Start)
        }.width('100%')
        .margin({top: 5})

        ListItem() {
          Column(){
            Text('F&Q')
              .fontSize(16)
          }.width('100%')
          .margin({left: 11})
          .alignItems(HorizontalAlign.Start)
        }.width('100%')
        // F&Q
        ForEach(this.FAQlist, (item: TCItemProp, index: number) => {
          ListItem() {
            Column({space: 3}) {
              Row({space: 3}) {
                Text('Â·')
                  .fontSize(32)
                  .fontWeight(FontWeight.Bolder)
                Text(item.title)
                  .fontSize(17)
                  .fontWeight(FontWeight.Medium)
              }.width('96%').margin({left: 8})
              Text(item.content)
                .fontSize(15)
                .margin({left: 11})
                .fontWeight(FontWeight.Regular)
            }.width('100%')
            .alignItems(HorizontalAlign.Start)
          }
        }, (item: TCItemProp) => getResourceString(item.title, this))
        // é™„å½•
        ListItem() {
         Column({space: 3}) {
           Text($r('app.string.attach'))
             .fontSize(15)
             .fontWeight(FontWeight.Regular)
           // è½¬æ¢é“¾æ¥
           ForEach(this.linkList, (item: TCItemProp, index: number) => {
             Row() {
               Text(`${getResourceString($r('app.string.link'), this)}${index + 1}ï¼š`)
                 .fontSize(15)
                 .fontWeight(FontWeight.Regular)
               Text(item.title)
                 .fontSize(15)
                 .fontColor(this.icon_emphasize)
                 .fontWeight(FontWeight.Regular)
                 .decoration({
                   type: TextDecorationType.Underline,
                   color: this.icon_emphasize
                 })
                 .onClick(() => {
                   implicitStartAbility(item.content as string, context)
                 })
             }.width('100%')
           }, (item: TCItemProp) => getResourceString(item.title, this))

         }.margin({left: 11})
          .alignItems(HorizontalAlign.Start)
        }.width('100%')

      }.width('100%')
      .contentEndOffset(85)
      .alignListItem(ListItemAlign.Center)
      .padding({ left: this.breakPointStatemorePageMargin.value, right: this.breakPointStatemorePageMargin.value })
    }.width('100%')
    .backgroundColor($r('app.color.background'))
    .hideTitleBar(true)
    .onBackPressed(() => {
      this.SettingsPageInfos.pop(true)
      return true
    })
  }
}

/**
 *  æ£€æŸ¥æ›´æ–°é¡µ
 */
@Component
export struct CheckUpdate {

  @State updateList: CheckUpdateListItemProp[] = []
  @Consume('NavSettingsPathStack') SettingsPageInfos: NavPathStack
  @Consume('breakPointStatemorePageMargin') breakPointStatemorePageMargin: BreakpointState<number>
  @StorageLink('uiConfig') uiConfig: UIConfig = new UIConfig()
  /* ä¸»é¢˜è‰² */
  @Consume('icon_emphasize') icon_emphasize: ResourceColor
  //ä¸€çº§å›¾æ ‡è‰²ï¼Œé»‘è‰²
  @State icon_primary: ResourceColor = $r('sys.color.icon_primary')
  @Consume theAppVersionInfo: UpdateInfo

  async aboutToAppear(): Promise<void> {
    if (!this.uiConfig.autoCheckUpdate) {
      await this.checkUpdate()
    }
    this.updateList = getCheckUpdateList(this.theAppVersionInfo)
  }

  async checkUpdate() {
    // æ£€æŸ¥ç‰ˆæœ¬æ›´æ–°
    try {
      const updateInfo = await getUpdateInfo()
      hilog.info(0xFF00, "UpdatetestTag", "Update Info: %{public}s", JSON.stringify(updateInfo))
      const theLatest = extractUpdateInfo(updateInfo)
      if (theLatest !== null) {
        promptAction.showToast({message: $r('app.string.query_success'), duration: 2000 })
        // æŸ¥è¯¢å®Œæˆ
        this.theAppVersionInfo = theLatest
      } else {
        hilog.info(0xFF00, "UpdatetestTag", "æå–æ›´æ–°ä¿¡æ¯å¤±è´¥")
      }
    } catch (err) {
      // å¤„ç†é”™è¯¯æƒ…å†µ
      const infoError = `Error:${JSON.stringify(err)}`
      hilog.info(0xFF00, "UpdatetestTag", "Info: %{public}s", infoError)
    }
  }

  build() {
    NavDestination() {
      TopBuilder({title: $r('app.string.Check_Updates')})
      Column({space: 10}) {
        ForEach(this.updateList, (item: CheckUpdateListItemProp, index: number) => {
          Column() {
            ForEach(item.children, (itemChild: CheckUpdateListItemProp, i: number) => {
              Column() {
                Row({space: 12}) {
                  // å›¾æ ‡
                  if(itemChild.icons) {
                    SymbolGlyph(itemChild.icons)
                      .fontSize(24)
                      .fontColor([this.icon_emphasize])
                  }
                  // æ ‡é¢˜
                  Column({space: 2}) {
                    Text(itemChild.title)
                      .fontWeight(FontWeight.Medium)
                      .fontSize(16)
                    if(itemChild.subtitle && item.title != 'Version') {
                      Text(itemChild.subtitle)
                        .fontWeight(FontWeight.Normal)
                        .fontSize(14)
                    }
                  }.layoutWeight(1)
                  .constraintSize({minHeight: 49})
                  .justifyContent(FlexAlign.Center)
                  .alignItems(HorizontalAlign.Start)
                  Blank()
                  if(item.title === 'Version') {
                    Text(itemChild.subtitle)
                      .fontWeight(FontWeight.Normal)
                      .fontSize(14)
                  } else {
                    SymbolGlyph($r('sys.symbol.chevron_right'))
                      .fontSize(24)
                      .fontColor([this.icon_primary])
                  }
                }.width('100%')
                .padding({left: 12, right: 12, top: 5, bottom: 5})
                .justifyContent(FlexAlign.Start)
                //åˆ†å‰²çº¿
                if(!isEnd(item.children!.length,i))
                  Row().height(0.5).backgroundColor($r('app.color.divider')).width('93%')
              }
              .width('100%')
                   .clickEffect(customAnimationUtil.isClickEffect(this.uiConfig))
              .onClick(() => {
                if(index === 1) {
                  // å‰å¾€ä¸‹è½½ç½‘é¡µ
                  hilog.info(0xFF00, "checkUpdateTest", "å‰å¾€ä¸‹è½½ç½‘é¡µ")
                 implicitStartAbility('https://github.com/xiaobaigroup/hapapp/releases', context)
                } else if(index === 3) {
                  // å¿½ç•¥æœ¬æ¬¡æ›´æ–°
                  promptAction.showToast({
                    message: $r('app.string.developing'),
                    duration: 2000
                  })
                } else if(index === 2) {
                  // å‰å¾€ä¸‹è½½
                  if (this.theAppVersionInfo.browser_download_url === '') {
                    promptAction.showToast({
                      message: $r('app.string.no_link'),
                      duration: 2000
                    })
                  } else {
                    implicitStartAbility(this.theAppVersionInfo.browser_download_url, context)
                  }

                }
              })
            })
          }
          .width('100%')
          .backgroundColor($r('app.color.container_background'))
          .borderRadius(BORDER_RADIUS_20)
        })
        // æç¤º
        Text() {
          Span($r('app.string.check_update_tips'))
          Span(`Telegram${getResourceString($r('app.string.check_update_tips_2'), context)}`)
            .fontColor(this.icon_emphasize)
            .onClick(() => {
              implicitStartAbility('https://t.me/+ihe73JZWYb40NTY1', context)
            })
          Span($r('app.string.check_update_tips_1'))
        }
          .fontWeight(FontWeight.Normal)
          .fontSize(15)
      }
      .width('100%')
      .padding({ left: this.breakPointStatemorePageMargin.value, right: this.breakPointStatemorePageMargin.value })
    }
    .width('100%')
    .backgroundColor($r('app.color.background'))
    .hideTitleBar(true)
    .onBackPressed(() => {
      this.SettingsPageInfos.pop(true)
      return true
    })
  }
}

/**
 * éšå¼ Want è·³è½¬ç½‘ç«™
 */
export async function implicitStartAbility(url: string, context: common.UIAbilityContext) {
  try {
    let want: Want = {
      // å¦‚æœå¸Œæœ›ä»…åœ¨ç‰¹å®šåŒ…ä¸­éšå¼æŸ¥è¯¢ï¼Œè¯·å–æ¶ˆä¸‹é¢çš„æ³¨é‡Šè¡Œ
      // bundleName: "com.example.myapplication",
      "action": "ohos.want.action.viewData",
      // entitieså¯ä»¥çœç•¥
      "entities": [ "entity.system.browsable" ],
      "uri": url,
    }
    await context.startAbility(want)
    console.info(`explicit start ability succeed`)
  } catch (error) {
    console.info(`explicit start ability failed with ${error.code}`)
  }
}

